# DeepInterview - Платформа для глубинных интервью

Веб-платформа для проведения глубинных интервью сотрудников, построенная на современном стеке технологий.

## Технологии

- **Frontend**: Next.js 14 + TypeScript + Tailwind CSS
- **Backend**: FastAPI + Python 3.11
- **База данных**: PostgreSQL 15
- **Контейнеризация**: Docker Compose

## Быстрый запуск

Проект полностью настроен для разворачивания одной командой:

```bash
docker-compose up --build
```

После запуска будут доступны:
- **Frontend**: http://localhost:3000
- **Backend API**: http://localhost:8000
- **API документация**: http://localhost:8000/docs

## Структура проекта

```
DeepInterview/
├── docker-compose.yml          # Конфигурация Docker Compose
├── .env                        # Переменные окружения
├── README.md                   # Документация
├── frontend/                   # Next.js приложение
│   ├── Dockerfile
│   ├── package.json
│   ├── tailwind.config.js
│   ├── next.config.js
│   ├── tsconfig.json
│   └── app/
│       ├── layout.tsx
│       ├── page.tsx
│       └── globals.css
├── backend/                    # FastAPI приложение
│   ├── Dockerfile
│   ├── requirements.txt
│   └── main.py
└── db/                         # Данные PostgreSQL
```

## API Endpoints

### Основные эндпоинты
- `GET /` - Главная страница API
- `GET /api/ping` - Проверка статуса API
- `GET /api/health` - Проверка здоровья системы с подключением к БД
- `POST /api/register` - Регистрация кандидата по ФИО
- `POST /api/chat` - Чат с ботом для проведения интервью

### Админские эндпоинты
- `POST /api/admin/login` - Вход в админку
- `GET /api/admin/dashboard` - Получение данных для админской панели
- `GET /api/admin/stats` - Получение статистики
- `GET /api/admin/analytics` - Получение аналитических данных
- `POST /api/admin/upload` - Загрузка CSV файла
- `GET /api/admin/export` - Экспорт данных кандидатов
- `GET /api/admin/report/{candidate_id}` - Генерация PDF отчёта для кандидата
- `GET /api/admin/report_excel/{candidate_id}` - Генерация Excel отчёта для кандидата

## Переменные окружения

Все настройки находятся в файле `.env`:

```env
DATABASE_URL=postgresql://user:password@db:5432/deepinterview
FRONTEND_URL=http://localhost:3000
BACKEND_URL=http://localhost:8000
NEXT_PUBLIC_BACKEND_URL=http://localhost:8000
SECRET_KEY=your-secret-key-here-change-in-production
PROCESS_RATE_PER_MINUTE=0.5
```

## Разработка

### Локальная разработка

Для разработки без Docker:

1. **Backend**:
   ```bash
   cd backend
   pip install -r requirements.txt
   uvicorn main:app --reload
   ```

2. **Frontend**:
   ```bash
   cd frontend
   npm install
   npm run dev
   ```

3. **База данных**:
   ```bash
   docker run --name deepinterview_db -e POSTGRES_DB=deepinterview -e POSTGRES_USER=user -e POSTGRES_PASSWORD=password -p 5432:5432 -d postgres:15
   ```

### Стоп и очистка

```bash
# Остановить контейнеры
docker-compose down

# Остановить и удалить volumes (данные БД)
docker-compose down -v
```

## Особенности

- ✅ Полностью контейнеризованное решение
- ✅ Автоматическая инициализация базы данных
- ✅ CORS настроен для работы frontend и backend
- ✅ Красивый современный UI с Tailwind CSS
- ✅ Проверка статуса API в реальном времени
- ✅ Регистрация кандидатов с проверкой по CSV файлу
- ✅ Автоматическая загрузка списка кандидатов при запуске
- ✅ Чат-бот для проведения глубинных интервью
- ✅ Валидация ответов пользователей
- ✅ Отслеживание прогресса интервью
- ✅ Система подбадривания
- ✅ Готово к продакшену

## Функциональность регистрации

Система поддерживает регистрацию кандидатов с проверкой по CSV файлу:

1. **Файл кандидатов**: `backend/uploads/candidates.csv`
   - Формат: ФИО, Процессы
   - Автоматически загружается при запуске сервера

2. **Страница регистрации**: `/register`
   - Ввод ФИО кандидата
   - Проверка по базе данных
   - Перенаправление при успешной регистрации

3. **API регистрации**: `POST /api/register`
   - Принимает: `{"full_name": "ФИО"}`
   - Возвращает: `{"status": "ok", "message": "allowed", "processes": [...]}` или `{"status": "error", "message": "forbidden"}`

## Функциональность чат-бота

Система включает полноценный чат-бот для проведения глубинных интервью:

1. **Чат-интерфейс**: 
   - Пузырьки сообщений (слева - бот, справа - пользователь)
   - Шкала прогресса интервью
   - Анимация "бот печатает"

2. **API чата**: `POST /api/chat`
   - Принимает: `{"full_name": "ФИО", "message": "ответ пользователя"}`
   - Возвращает: `{"bot_message": "сообщение бота", "progress": 0-100}`

3. **Логика интервью**:
   - 6 вопросов для каждого процесса кандидата
   - Валидация ответов (проверка на неопределенные слова)
   - Уточняющие вопросы при неточных ответах
   - Система подбадривания каждые 3 корректных ответа

4. **Вопросы по процессам**:
   - Как начинается процесс?
   - Сколько времени занимает одна итерация (в минутах)?
   - Как часто процесс повторяется?
   - Сколько раз процесс повторяется за одну сессию?
   - Как понимаете, что процесс завершён?
   - Какие программы или инструменты вы используете?

5. **Сохранение данных**: Все ответы сохраняются в таблице InterviewAnswer с валидацией

## Админская панель

Система включает полноценную админскую панель для HR:

1. **Авторизация**: 
   - Страница входа `/admin/login`
   - Логин: `admin`, Пароль: `password123`
   - JWT токены для безопасности

2. **Админская панель** `/admin/dashboard`:
   - Таблица всех кандидатов с статусами интервью
   - Статистика: общее количество, завершенные, в процессе, не начатые
   - Фильтры и сортировка данных

3. **Функциональность**:
   - Загрузка новых CSV файлов с кандидатами
   - Экспорт данных в CSV формат
   - Обновление существующих записей без потери данных

4. **Аналитика**:
   - Расчет времени и стоимости процессов
   - Метрики по каждому кандидату
   - Сортировка по времени и стоимости

5. **Безопасность**:
   - JWT авторизация для всех админских маршрутов
   - Автоматическое перенаправление на страницу входа
   - Защищенные API эндпоинты

6. **Генерация отчётов**:
   - Автоматическая генерация PDF и Excel отчётов
   - Детальная информация по каждому процессу
   - Расчёт метрик времени и стоимости
   - Модальное окно для выбора формата отчёта
   - Спиннер загрузки при генерации отчётов

## Требования

- Docker
- Docker Compose
- Порты 3000, 8000, 5432 должны быть свободны
