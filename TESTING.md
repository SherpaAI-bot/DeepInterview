# Тестирование функциональности регистрации

## Тестовые данные

В файле `backend/uploads/candidates.csv` содержатся следующие тестовые кандидаты:

| ФИО | Процессы |
|-----|----------|
| Иванов Иван Иванович | Разработка, Тестирование |
| Петров Петр Петрович | Аналитика, Управление проектами |
| Сидорова Анна Сергеевна | Дизайн, UX/UI |
| Козлов Михаил Александрович | DevOps, Инфраструктура |
| Смирнова Елена Владимировна | Маркетинг, Продажи |

## Сценарии тестирования

### 1. Успешная регистрация

1. Откройте http://localhost:3000
2. Нажмите "Начать интервью"
3. Введите одно из тестовых ФИО (например: "Иванов Иван Иванович")
4. Нажмите "Начать интервью"
5. **Ожидаемый результат**: Перенаправление на страницу /chat

### 2. Неуспешная регистрация

1. Откройте http://localhost:3000/register
2. Введите ФИО, которого нет в списке (например: "Неизвестный Пользователь")
3. Нажмите "Начать интервью"
4. **Ожидаемый результат**: Сообщение "Вы не включены в список кандидатов"

### 3. Проверка API напрямую

#### Успешная регистрация:
```bash
curl -X POST http://localhost:8000/api/register \
  -H "Content-Type: application/json" \
  -d '{"full_name": "Иванов Иван Иванович"}'
```

**Ожидаемый ответ:**
```json
{
  "status": "ok",
  "message": "allowed",
  "processes": ["Разработка", "Тестирование"]
}
```

#### Неуспешная регистрация:
```bash
curl -X POST http://localhost:8000/api/register \
  -H "Content-Type: application/json" \
  -d '{"full_name": "Неизвестный Пользователь"}'
```

**Ожидаемый ответ:**
```json
{
  "status": "error",
  "message": "forbidden"
}
```

## Проверка базы данных

После запуска системы можно проверить, что данные загружены в базу:

1. Подключитесь к PostgreSQL контейнеру:
```bash
docker exec -it deepinterview_db psql -U user -d deepinterview
```

2. Выполните запрос:
```sql
SELECT * FROM candidates;
```

Должны отобразиться все 5 тестовых кандидатов.

## Добавление новых кандидатов

Для добавления новых кандидатов:

1. Отредактируйте файл `backend/uploads/candidates.csv`
2. Добавьте новые строки в формате: `ФИО,Процессы`
3. Перезапустите контейнер backend:
```bash
docker-compose restart backend
```

Данные автоматически перезагрузятся при следующем запуске.

## Тестирование чат-функциональности

### 1. Полный цикл интервью

1. Откройте http://localhost:3000
2. Нажмите "Начать интервью"
3. Введите тестовое ФИО (например: "Иванов Иван Иванович")
4. Нажмите "Начать интервью"
5. Вы будете перенаправлены на страницу чата
6. **Ожидаемый результат**: Бот задаст первый вопрос по процессу "Разработка"

### 2. Тестирование валидации ответов

#### Неопределенные ответы (должны вызывать уточнение):
- Ответ: "Иногда по-разному"
- Ответ: "Обычно когда как"
- **Ожидаемый результат**: Бот попросит уточнить ответ

#### Ответы без цифр на вопросы про время:
- Вопрос: "Сколько времени занимает одна итерация?"
- Ответ: "Долго"
- **Ожидаемый результат**: Бот попросит указать время в минутах

#### Корректные ответы:
- Ответ: "Около 30 минут"
- Ответ: "5 раз в день"
- **Ожидаемый результат**: Бот перейдет к следующему вопросу

### 3. Тестирование прогресса

1. Отвечайте на вопросы корректно
2. Следите за шкалой прогресса сверху
3. **Ожидаемый результат**: Прогресс должен увеличиваться с каждым ответом

### 4. Тестирование подбадривания

1. Дайте 3 корректных ответа подряд
2. **Ожидаемый результат**: Бот должен показать сообщение подбадривания

### 5. Тестирование завершения интервью

1. Ответьте на все вопросы по всем процессам
2. **Ожидаемый результат**: 
   - Прогресс достигнет 100%
   - Появится сообщение "Ваше интервью завершено! Спасибо за участие!"
   - Покажется анимация завершения

### 6. Проверка API чата напрямую

#### Начало интервью:
```bash
curl -X POST http://localhost:8000/api/chat \
  -H "Content-Type: application/json" \
  -d '{"full_name": "Иванов Иван Иванович", "message": "Начать интервью"}'
```

**Ожидаемый ответ:**
```json
{
  "bot_message": "Процесс: Разработка\n\nКак начинается процесс?",
  "progress": 0
}
```

#### Ответ на вопрос:
```bash
curl -X POST http://localhost:8000/api/chat \
  -H "Content-Type: application/json" \
  -d '{"full_name": "Иванов Иван Иванович", "message": "Начинается с планирования задач"}'
```

**Ожидаемый ответ:**
```json
{
  "bot_message": "Процесс: Разработка\n\nСколько времени занимает одна итерация (в минутах)?",
  "progress": 16
}
```

### 7. Проверка сохранения ответов в БД

После прохождения интервью можно проверить сохраненные ответы:

```bash
docker exec -it deepinterview_db psql -U user -d deepinterview
```

```sql
SELECT ia.question, ia.answer, ia.is_valid, ia.process 
FROM interview_answers ia 
JOIN candidates c ON ia.candidate_id = c.id 
WHERE c.full_name = 'Иванов Иван Иванович';
```

## Сценарии тестирования по процессам

Для каждого кандидата система задает 6 вопросов по каждому процессу:

### Иванов Иван Иванович (Разработка, Тестирование)
- **Процесс 1**: Разработка (6 вопросов)
- **Процесс 2**: Тестирование (6 вопросов)
- **Всего вопросов**: 12

### Петров Петр Петрович (Аналитика, Управление проектами)
- **Процесс 1**: Аналитика (6 вопросов)
- **Процесс 2**: Управление проектами (6 вопросов)
- **Всего вопросов**: 12

И так далее для всех кандидатов.

## Тестирование админской панели

### 1. Вход в админку

1. Откройте http://localhost:3000
2. Нажмите кнопку "Админка"
3. На странице входа введите:
   - Логин: `admin`
   - Пароль: `password123`
4. Нажмите "Войти"
5. **Ожидаемый результат**: Перенаправление на админскую панель

### 2. Просмотр статистики

1. После входа в админку проверьте карточки статистики
2. **Ожидаемый результат**: Отображение количества кандидатов, завершенных, в процессе и не начатых интервью

### 3. Просмотр таблицы кандидатов

1. Просмотрите таблицу кандидатов
2. **Ожидаемый результат**: 
   - Отображение ФИО, процессов, статуса интервью
   - Прогресс-бары для каждого кандидата
   - Цветовая индикация статусов

### 4. Тестирование загрузки CSV

1. Подготовьте CSV файл с новыми кандидатами:
```csv
ФИО,Процессы
Новый Кандидат 1,"Разработка, Аналитика"
Новый Кандидат 2,"Тестирование, DevOps"
```

2. Нажмите "Выберите файл" и выберите CSV
3. Нажмите "Загрузить CSV"
4. **Ожидаемый результат**: Успешная загрузка и обновление таблицы

### 5. Тестирование экспорта данных

1. Нажмите кнопку "Экспортировать данные"
2. **Ожидаемый результат**: Скачивание CSV файла с данными всех кандидатов

### 6. Проверка аналитики

1. Просмотрите блок "Метрики"
2. **Ожидаемый результат**: Таблица с ФИО, временем, стоимостью и количеством процессов

### 7. Проверка API админки напрямую

#### Вход в админку:
```bash
curl -X POST http://localhost:8000/api/admin/login \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "password123"}'
```

**Ожидаемый ответ:**
```json
{
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "token_type": "bearer"
}
```

#### Получение данных панели:
```bash
curl -X GET http://localhost:8000/api/admin/dashboard \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

#### Получение статистики:
```bash
curl -X GET http://localhost:8000/api/admin/stats \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

### 8. Проверка безопасности

1. Попробуйте получить доступ к админским эндпоинтам без токена
2. **Ожидаемый результат**: Ошибка 401 Unauthorized

### 9. Тестирование обновления данных

1. Загрузите CSV с существующими кандидатами
2. Измените их процессы
3. **Ожидаемый результат**: Обновление данных без создания дубликатов

## Тестирование генерации отчётов

### 1. Генерация PDF отчётного

1. В админской панели найдите кандидата с завершенным интервью
2. Нажмите кнопку "📄 Отчёт" в строке кандидата
3. В модальном окне нажмите "Скачать PDF"
4. **Ожидаемый результат**: 
   - Появится спиннер "Генерируется..."
   - Скачается PDF файл с отчётом
   - Отчёт содержит ФИО, процессы, метрики и ответы на вопросы

### 2. Генерация Excel отчёта

1. В админской панели найдите кандидата с завершенным интервью
2. Нажмите кнопку "📄 Отчёт" в строке кандидата
3. В модальном окне нажмите "Скачать Excel"
4. **Ожидаемый результат**: 
   - Появится спиннер "Генерируется..."
   - Скачается Excel файл с отчётом
   - Отчёт содержит структурированные данные по процессам

### 3. Проверка содержимого отчёта

PDF и Excel отчёты должны содержать:
- **Информацию о кандидате**: ФИО, процессы, дата формирования
- **Данные по каждому процессу**:
  - Время одной итерации (мин)
  - Частота выполнения
  - Количество повторов за сессию
  - Общее время (мин)
  - Стоимость процесса (₽)
  - Используемые инструменты
- **Ответы на вопросы**: Все вопросы и ответы по каждому процессу
- **Подпись**: "Сформировано автоматически системой DeepInterview"

### 4. Проверка API генерации отчётов

#### Генерация PDF отчёта:
```bash
curl -X GET http://localhost:8000/api/admin/report/1 \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -o report_candidate_1.pdf
```

#### Генерация Excel отчёта:
```bash
curl -X GET http://localhost:8000/api/admin/report_excel/1 \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -o report_candidate_1.xlsx
```

### 5. Тестирование ошибок

1. Попробуйте сгенерировать отчёт для кандидата без завершенного интервью
2. **Ожидаемый результат**: Отчёт должен генерироваться с доступными данными

3. Попробуйте сгенерировать отчёт без авторизации
4. **Ожидаемый результат**: Ошибка 401 Unauthorized

### 6. Проверка производительности

1. Сгенерируйте отчёт для кандидата с большим количеством процессов
2. **Ожидаемый результат**: Отчёт должен генерироваться в разумное время (не более 10 секунд)
